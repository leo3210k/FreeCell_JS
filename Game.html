<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>testando</title>
    <script src="js/jquery.js"></script>
    <style>
        * {
            margin: 0px;
            box-sizing: border-box;
        }

        .principal {
            height: 100%;
            background-color: green;
        }

        .superior {
            height: 120px;
            border-bottom: solid 2px white;
            display: flex;
            justify-content: space-around;
        }

        .inferior {
            border: solid 2px red;
            display: flex;
            justify-content: space-around;
        }

        .square {
            width: 80px;
            height: 95px;
            margin: 10px;
            border: solid 1px black;
        }

        .divisor {
            height: 100%;
            border: solid 2px white;
        }

        #sd1,
        #sd2,
        #sd3,
        #sd4,
        #sd5,
        #sd6,
        #sd7,
        #sd8 {
            display: flex;
            flex-direction: column;
        }

        .red {
            background-color: red;
        }
    </style>
</head>

<body>
    <script>
        let y1 = 130
        let y2 = 130
        let y3 = 130
        let y4 = 130
        let y5 = 130
        let y6 = 130
        let y7 = 130
        let y8 = 130

        const y9 = 10
        const y10 = 10
        const y11 = 10
        const y12 = 10

        const sd1 = new Array
        const sd2 = new Array
        const sd3 = new Array
        const sd4 = new Array
        const sd5 = new Array
        const sd6 = new Array
        const sd7 = new Array
        const sd8 = new Array

        const su1 = new Array
        const su2 = new Array
        const su3 = new Array
        const su4 = new Array
        const su5 = new Array
        const su6 = new Array
        const su7 = new Array
        const su8 = new Array

        let card = new Object
        let isSelect = false
        let back = new Object

        const red = 0
        const black = 1

        const take = id => document.getElementById(id)

        function criar() {
            const img1 = document.createElement('img')
            img1.src = "./cards/suits/diamonds.png"
            img1.style.width = "80px"
            img1.style.height = "95px"
            su5.push({ suit: 0 })
            $('#su5').append(img1)

            const img2 = document.createElement('img')
            img2.src = "./cards/suits/hearts.png"
            img2.style.width = "80px"
            img2.style.height = "95px"
            su6.push({ suit: 1 })
            $('#su6').append(img2)

            const img3 = document.createElement('img')
            img3.src = "./cards/suits/spades.png"
            img3.style.width = "80px"
            img3.style.height = "95px"
            su7.push({ suit: 2 })
            $('#su7').append(img3)

            const img4 = document.createElement('img')
            img4.src = "./cards/suits/clubs.png"
            img4.style.width = "80px"
            img4.style.height = "95px"
            su8.push({ suit: 3 })
            $('#su8').append(img4)

            for (let i = 1; i <= 13; i++) {
                const img = document.createElement('img')
                img.src = `./cards/diamonds/${i}.png`
                img.style.width = "80px"
                img.style.height = "95px"
                img.style.position = "absolute"

                embaralhar(img, 0, i)
            }

            for (let i = 1; i <= 13; i++) {
                const img = document.createElement('img')
                img.src = `./cards/hearts/${i}.png`
                img.style.width = "80px"
                img.style.height = "95px"
                img.style.position = "absolute"

                embaralhar(img, 1, i)
            }

            for (let i = 1; i <= 13; i++) {
                const img = document.createElement('img')
                img.src = `./cards/spades/${i}.png`
                img.style.width = "80px"
                img.style.height = "95px"
                img.style.position = "absolute"

                embaralhar(img, 2, i)
            }

            for (let i = 1; i <= 13; i++) {
                const img = document.createElement('img')
                img.src = `./cards/clubs/${i}.png`
                img.style.width = "80px"
                img.style.height = "95px"
                img.style.position = "absolute"

                embaralhar(img, 3, i)
            }
        }

        function suit(value) {
            if (value === 0 || value === 1) {
                return red
            } else {
                return black
            }
        }

        function adicionar(destino, ...origem) {
            for (i in origem) {
                $(destino).append(origem[i])
            }
        }

        function embaralhar(element, suit, value) {
            min = Math.ceil(1)
            max = Math.floor(9)
            const aleatorio = Math.floor(Math.random() * (max - min))

            switch (aleatorio) {
                case 0:
                    $('#sd1').append(element)
                    element.style.top = `${y1}px`
                    sd1.push({ element, suit, value })

                    y1 += 20
                    break;
                case 1:
                    $('#sd2').append(element)
                    element.style.top = `${y2}px`
                    sd2.push({ element, suit, value })

                    y2 += 20
                    break;
                case 2:
                    $('#sd3').append(element)
                    element.style.top = `${y3}px`
                    sd3.push({ element, suit, value })

                    y3 += 20
                    break;
                case 3:
                    $('#sd4').append(element)
                    element.style.top = `${y4}px`
                    sd4.push({ element, suit, value })

                    y4 += 20
                    break;
                case 4:
                    $('#sd5').append(element)
                    element.style.top = `${y5}px`
                    sd5.push({ element, suit, value })

                    y5 += 20
                    break;
                case 5:
                    $('#sd6').append(element)
                    element.style.top = `${y6}px`
                    sd6.push({ element, suit, value })

                    y6 += 20
                    break;
                case 6:
                    $('#sd7').append(element)
                    element.style.top = `${y7}px`
                    sd7.push({ element, suit, value })

                    y7 += 20
                    break;
                case 7:
                    $('#sd8').append(element)
                    element.style.top = `${y8}px`
                    sd8.push({ element, suit, value })

                    y8 += 20
                    break;
            }
        }

        function setEvent(stack, object, id, y) {
            console.log('Entrou')
            $(`#${id} > img:last`).click(e => {
                if (!isSelect) {

                    card = object

                    $(`#${id} > img:last`).off('click')
                    stack.pop()
                    $(`#${id} > img:last`).remove()

                    isSelect = true
                    y -= 20
                    back = { stack, id, y }

                    if (stack.length === 0) {
                        empty(stack, id, y)
                    } else {
                        setEvent(stack, stack[stack.length - 1], id, y)
                    }
                } else {
                    if (rules(id, object)) {

                        stack.push({ element: card.element, suit: card.suit, value: card.value })
                        $(`#${id} > img:last`).off('click')
                        $(`#${id}`).append(card.element)
                        stack[stack.length - 1].element.style.top = `${y}px`

                        isSelect = false
                        y += 20

                        setEvent(stack, stack[stack.length - 1], id, y)
                    } else {
                        reset(back.stack, back.id, back.y)
                    }
                }

            })
        }

        function empty(stack, id, y) {
            $(`#${id}`).on('dblclick', e => {
                if (isSelect) {

                    stack.push({ element: card.element, suit: card.suit, value: card.value })
                    $(`#${id}`).append(card.element)
                    stack[stack.length - 1].element.style.top = `${y}px`

                    isSelect = false
                    if (id !== 'su1' && 'su2' && 'su3' || 'su4') { y += 20 }

                    $(`#${id}`).off('dblclick')

                    setEvent(stack, stack[stack.length - 1], id, y)
                }
            })
        }

        function reset(stack, id, y) {
            stack.push({ element: card.element, suit: card.suit, value: card.value })
            $(`#${id} > img:last`).off('click')
            $(`#${id}`).append(card.element)
            stack[stack.length - 1].element.style.top = `${y}px`

            isSelect = false
            y += 20

            setEvent(stack, stack[stack.length - 1], id, y)
        }

        function rules(id, object) {
            console.log(card.suit)
            console.log(object.suit)
            if (id !== 'su1') {
                if (id !== 'su2') {
                    if (id !== 'su3') {
                        if (id !== 'su4') {
                            console.log(suit(card.suit), suit(object.suit))
                            if (suit(card.suit) !== suit(object.suit)) {
                                if (card.value === object.value - 1) {
                                    return true
                                } else { return false }
                            } else { return false }
                        } else { return false }
                    } else { return false }
                } else { return false }
            } else { return false }
        }

        function setGameOver() {

        }


        $('body').css('background-color', 'green')
        const superior = $('<div>').addClass('superior').appendTo('body')

        adicionar(superior, '<div id="su1" class="square">', '<div id="su2" class="square">', '<div id="su3" class="square">', '<div id="su4" class="square">',
            '<div class="divisor">', '<div id="su5" class="square">', '<div id="su6" class="square">', '<div id="su7" class="square">', '<div id="su8" class="square">')

        const inferior = $('<div class="inferior">').appendTo('body')

        adicionar(inferior, '<div id="sd1" class="square">', '<div id="sd2" class="square">', '<div id="sd3" class="square">', '<div id="sd4" class="square">'
            , '<div id="sd5" class="square">', '<div id="sd6" class="square">', '<div id="sd7" class="square">', '<div id="sd8" class="square">')

        criar()

        //$('body').dblclick(e => {
        //$('body').toggleClass('red')
        //})

        setEvent(sd1, sd1[sd1.length - 1], 'sd1', y1)
        setEvent(sd2, sd2[sd2.length - 1], 'sd2', y2)
        setEvent(sd3, sd3[sd3.length - 1], 'sd3', y3)
        setEvent(sd4, sd4[sd4.length - 1], 'sd4', y4)
        setEvent(sd5, sd5[sd5.length - 1], 'sd5', y5)
        setEvent(sd6, sd6[sd6.length - 1], 'sd6', y6)
        setEvent(sd7, sd7[sd7.length - 1], 'sd7', y7)
        setEvent(sd8, sd8[sd8.length - 1], 'sd8', y8)

        empty(su1, 'su1', y9)
        empty(su2, 'su2', y10)
        empty(su3, 'su3', y11)
        empty(su4, 'su4', y12)

    </script>
</body>

</html>